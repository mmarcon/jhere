(function(e){function i(e){return e instanceof Array?{latitude:e[0],longitude:e[1]}:e}var t,n,r={type:"shortest",transportMode:"car",options:"",trafficMode:"default",width:4,color:"#ff6347",marker:{text:"#",textColor:"#fff"},zoomTo:!0};n=function(n,s,o,u){var a,f,l,c;t=t||nokia.maps,n=i(n),s=i(s),Object.prototype.toString.call(o)==="[object Array]"?u=e.extend({},r,u):(u=e.extend({},r,o),o=[]),l=function(n,r,i){var s,o,a,f,l,c={},h;i==="finished"?(s=n.getRoutes(),f=s[0],a=new t.map.Polyline(f&&f.shape,{pen:new t.util.Pen({lineWidth:u.width,strokeColor:u.color})}),o=new t.map.Container,o.objects.add(a),e.each(f.waypoints,e.proxy(function(t,n){var r=e.extend({},u.marker);u.marker.text==="#"&&(r.text=t+1),this.marker(n.originalPosition,r)},this)),this.map.objects.add(o),u.zoomTo&&this.map.zoomTo(o.getBoundingBox(),!1,"default"),l=f.legs&&f.legs.length&&f.legs[0],c.time=l.travelTime,c.length=l.length,c.maneuvers=l.maneuvers,typeof u.onroute=="function"&&u.onroute.call(this.element,c),h=e.Event("jhere.route",{route:c,target:this.element}),e(this.element).trigger(h)):i==="failed"&&e.error("Failed to calculate route")},a=new t.routing.Manager,a.addObserver("state",e.proxy(l,this)),f=new t.routing.WaypointParameterList,f.addCoordinate(n),e.each(o,function(e,t){f.addCoordinate(i(t))}),f.addCoordinate(s),c={transportModes:[u.transportMode],type:u.type,options:u.options,trafficMode:u.trafficMode},a.calculateRoute(f,[c])},e.jHERE.extend("route",n)})(jQuery);
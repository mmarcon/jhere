(function(e){function r(e){return e.match(/^\s*$/)}function i(e){return typeof e=="string"}function s(e){return typeof e=="function"}function o(e,t){if(r(e.query))return t.resolve([]);nokia.places.search.manager.findPlaces({searchTerm:e.query,useGeoLocation:e.useGeoLocation,onComplete:function(n,r){if(r!=="OK")return t.reject();var i=u(n,e),s=[];i.forEach(function(e){var n=e.position;n.onComplete=function(r,o){o==="OK"?s.push(a(r)):(delete n.onComplete,s.push(e)),s.length===i.length&&t.resolve(s)},nokia.places.search.manager.reverseGeoCode(n)})}})}function u(e,n){return e.results.items.filter(function(e){return e.category.categoryId===t}).slice(0,n.resultsLimit)}function a(e){return e.location}function f(e){if(!e||i(e))e={query:e};var t={};for(var r in n)n.hasOwnProperty(r)&&(t[r]=e[r]||n[r]);return t}var t="city-town-village",n={query:"",resultsLimit:10,useGeoLocation:!0};e.jHERE.searchCities=function(t,n,r){var i=e.Deferred(),u=i.promise();return n=s(n)?n:e.noop,r=s(r)?r:e.noop,e.jHERE._JSLALoader.load().is.done(function(){o(f(t),i)}),e.when(u).then(function(e){n(e)},function(e){r(e)}),u}})(jQuery);